# Checklist Manipulation UI

**Expected result**

- Task detail modal/view with comprehensive checklist management interface
- Status-based SVG checkbox states with visual feedback: unchecked, checked, blocked, final check awaiting
- Inline text editing for checklist items with proper validation
- Add/delete checklist items functionality
- Real-time status indicators with color coding
- Collapsible checklist section with item count display
- Consistent edit/delete icon alignment and spacing
- Mobile-responsive design with touch-friendly controls

**Actual result**

- TaskCreationModal exists with basic title input and static checklist preview only
- Dashboard shows task list with basic progress bars but no detailed checklist interaction
- No task detail view component exists for checklist management
- Store methods exist: `updateChecklistItemStatus`, `addChecklistItem`, `deleteChecklistItem`, `updateChecklistItemText`
- FloorPlanView calculates task status from checklist but no UI for manipulation
- Static checklist template preview in TaskCreationModal shows intended design direction

**Evidence from codebase analysis**

1. **Store implementation complete**: TaskStore contains all required CRUD operations for checklist manipulation with proper RxDB integration and state management
2. **UI components missing**: No TaskDetailModal or ChecklistView component exists - critical UI gap
3. **Design patterns established**: TaskCreationModal demonstrates modal pattern, Dashboard shows list pattern
4. **SVG icon infrastructure**: Existing components use consistent SVG patterns for UI elements
5. **Status color mapping exists**: FLOOR_PLAN_CONSTANTS.STATUS_COLORS provides color scheme for all 5 statuses
6. **Template system functional**: DEFAULT_CHECKLIST constant provides hardcoded template structure as specified

**Store method analysis**

Running evidence-based analysis of store checklist methods:

- ✅ `updateChecklistItemStatus`: Properly updates RxDB, syncs in-memory state, triggers repaint markers
- ✅ `addChecklistItem`: Creates new items with UUID, proper ordering, database persistence
- ✅ `deleteChecklistItem`: Removes items with state synchronization and repaint triggers
- ✅ `updateChecklistItemText`: Text editing with immediate persistence
- ⚠️ **Performance consideration**: All checklist operations trigger `tasksNeedingRepaint` - may cause unnecessary PixiJS redraws for non-visual changes like text editing

**UI requirements based on specifications**

From copilot-instructions.md analysis:

- **Checkbox states**: 5 visual states (not_started, in_progress, blocked, final_check_awaiting, done)
- **SVG rendering**: Custom checkbox SVG components with state-specific styling
- **Status indicators**: Small circular icons with color coding per status
- **Edit/delete workflow**: Pencil edit icon, trash delete icon in edit mode
- **Collapsible design**: "Checklist" section with expand/collapse functionality
- **Item count display**: "STEPS N" caption showing total checklist items
- **Add item button**: "+" icon with "Add new item" text at bottom

**Performance evidence gaps**

⚠️ **Checklist repaint analysis needed**: Current implementation marks tasks for PixiJS repaint on ALL checklist operations. Evidence shows:

- Text editing (`updateChecklistItemText`) triggers repaint - may be unnecessary since text changes don't affect marker visuals
- Status changes trigger repaint - correct behavior for marker color updates
- Add/delete operations trigger repaint - correct for potential status aggregation changes

**Web research findings on checklist UI patterns**

Evidence from Ant Design and Material Design:

- **Checkbox component patterns**: Support for indeterminate states, controlled/uncontrolled modes
- **List item heights**: Standardized heights (56dp, 72dp, 88dp) based on content
- **Status visualization**: Consistent icon placement and color coding
- **Accessibility**: Focus management, keyboard navigation, ARIA labels
- **Touch targets**: Minimum 44px touch targets for mobile interaction

**Suggestions**

**Phase 1: Core Task Detail Modal**

- Create TaskDetailModal component with proper modal patterns from TaskCreationModal
- Implement basic task info display (title, coordinates, progress)
- Add collapsible checklist section with hardcoded expand state initially
- Integrate with Dashboard task list click events

**Phase 2: Checklist Item Rendering**

- Create ChecklistItem component with 5-state SVG checkbox system
- Implement status color mapping from FLOOR_PLAN_CONSTANTS
- Add status indicator icons (circular, colored per status)
- Ensure proper alignment: checkbox column, text column, action column

**Phase 3: Interactive Checklist Operations**

- Implement status change handlers using existing store methods
- Add inline text editing with validation and error handling
- Create add/delete item workflow with proper UX feedback
- Add "STEPS N" counter with dynamic updates

**Phase 4: Performance Optimization**

- Analyze checklist operation repaint triggers
- Optimize `updateChecklistItemText` to avoid unnecessary PixiJS redraws
- Add error boundaries and loading states for store operations
- Implement proper form validation and user feedback

**Phase 5: Mobile and Accessibility**

- Ensure 44px minimum touch targets for mobile devices
- Add keyboard navigation support for checklist items
- Implement ARIA labels and semantic HTML structure
- Test with screen readers and accessibility tools

**Critical architectural decisions**

1. **Modal vs inline editing**: Modal approach provides focus and prevents dashboard interaction conflicts
2. **State management**: Leverage existing store methods - no additional state layer needed
3. **SVG vs icon library**: Custom SVG maintains design control and performance (no external dependencies)
4. **Repaint optimization**: Investigate selective repaint logic for checklist operations
5. **Error handling**: Add try-catch blocks around all store operations with user feedback

**Risk assessment**

- **High complexity**: Checklist UI requires coordination of multiple interaction patterns
- **Performance impact**: Current repaint strategy may cause unnecessary canvas redraws
- **Mobile usability**: Touch targets and responsive design critical for field use
- **Data consistency**: Ensure UI state synchronization with RxDB persistence layer
- **Error scenarios**: Network failures, concurrent edits, data validation edge cases

**Priority: HIGH** - Final core feature needed to complete MVP functionality. All backend infrastructure exists, only UI layer missing.

---

Surgically enhance existing UI:

1. at PixiJS viewport whole content should be draggable to provide panning experience to the user, dragging must apply to the container, to keep O(1) , see code base to clarity what this is

2. Overall look and feel of the Tasks card needs to be revamped, limiting the changes to presentation layer only surgically not breaking interrelations with underlying store infrastructure.
   Expected look and feel:
   Super elegant business style with one beautiful super modern aero transculent matte glass element (heading or something similar) with maximum elegance in font sizes, SVG checkboxes and icons, with smooth CSS animations for modal opening, for appearing of new item and item removal , for checkbox state transition

Go ahead. Development: act surgically by creating the todo list and working focusing on each particular item of todo list and doing work professionally making surgical code adjustments to minimize the affected area of the application to avoid breaking anything else
